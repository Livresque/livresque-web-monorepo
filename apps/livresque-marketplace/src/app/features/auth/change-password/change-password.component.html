<div class="relative flex min-h-screen w-full flex-col">
  <app-header></app-header>
  <main class="flex-1 flex items-center justify-center px-4 py-12">
    <div class="w-full max-w-md">
      <div class="w-full rounded-2xl bg-surface-dark border border-surface-highlight p-8 shadow-2xl shadow-black/20">
        <div class="text-center mb-8">
          <div class="inline-flex h-16 w-16 items-center justify-center rounded-full bg-primary/10 mb-4">
            <span class="material-symbols-outlined text-primary text-[32px]">lock_open</span>
          </div>
          <h2 class="text-3xl font-black text-white">Nouveau mot de passe</h2>
          <p class="text-gray-400 mt-2">Créez un mot de passe sécurisé pour votre compte.</p>
        </div>
        
        <form class="space-y-6" (ngSubmit)="onSubmit()">
          <!-- Nouveau mot de passe -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2" for="newPassword">
              Nouveau mot de passe
            </label>
            <div class="relative">
              <span class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                <span class="material-symbols-outlined text-gray-500">lock</span>
              </span>
              <input 
                class="block w-full rounded-lg border border-surface-highlight bg-surface-highlight/50 py-3 pl-10 pr-12 text-white placeholder:text-gray-500 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary transition" 
                id="newPassword" 
                name="newPassword" 
                [(ngModel)]="newPassword"
                (input)="onPasswordInput()"
                [type]="showNewPassword ? 'text' : 'password'"
                placeholder="••••••••" 
                required/>
              <button
                type="button"
                (click)="toggleNewPasswordVisibility()"
                class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-300 transition">
                <span class="material-symbols-outlined text-[20px]">
                  {{ showNewPassword ? 'visibility_off' : 'visibility' }}
                </span>
              </button>
            </div>
            
            <!-- Indicateur de force du mot de passe -->
            <div class="mt-2" *ngIf="newPassword">
              <div class="flex gap-1 mb-1">
                <div 
                  *ngFor="let i of [1,2,3,4,5]" 
                  class="h-1 flex-1 rounded-full transition-colors"
                  [class]="i <= passwordStrength ? getPasswordStrengthColor() : 'bg-surface-highlight'">
                </div>
              </div>
              <p class="text-xs" [class]="passwordStrength >= 4 ? 'text-green-500' : 'text-gray-400'">
                Force: {{ getPasswordStrengthLabel() }}
              </p>
            </div>
          </div>
          
          <!-- Confirmer mot de passe -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2" for="confirmPassword">
              Confirmer le mot de passe
            </label>
            <div class="relative">
              <span class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                <span class="material-symbols-outlined text-gray-500">lock</span>
              </span>
              <input 
                class="block w-full rounded-lg border border-surface-highlight bg-surface-highlight/50 py-3 pl-10 pr-12 text-white placeholder:text-gray-500 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary transition" 
                id="confirmPassword" 
                name="confirmPassword" 
                [(ngModel)]="confirmPassword"
                [type]="showConfirmPassword ? 'text' : 'password'"
                placeholder="••••••••" 
                required/>
              <button
                type="button"
                (click)="toggleConfirmPasswordVisibility()"
                class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-300 transition">
                <span class="material-symbols-outlined text-[20px]">
                  {{ showConfirmPassword ? 'visibility_off' : 'visibility' }}
                </span>
              </button>
            </div>
          </div>

          <!-- Message d'erreur -->
          <div *ngIf="errorMessage" class="rounded-lg bg-red-500/10 border border-red-500/50 p-3">
            <div class="flex items-center gap-2 text-red-500 text-sm">
              <span class="material-symbols-outlined text-[18px]">error</span>
              {{ errorMessage }}
            </div>
          </div>

          <!-- Conseils de sécurité -->
          <div class="rounded-lg bg-surface-highlight/30 border border-surface-highlight p-4">
            <p class="text-xs text-gray-400 mb-2 font-medium">Le mot de passe doit contenir :</p>
            <ul class="space-y-1 text-xs text-gray-400">
              <li class="flex items-center gap-2">
                <span class="material-symbols-outlined text-[14px]" 
                      [class.text-green-500]="newPassword.length >= 8"
                      [class.text-gray-500]="newPassword.length < 8">
                  {{ newPassword.length >= 8 ? 'check_circle' : 'radio_button_unchecked' }}
                </span>
                Au moins 8 caractères
              </li>
              <li class="flex items-center gap-2">
                <span class="material-symbols-outlined text-[14px]"
                      [class.text-green-500]="/[A-Z]/.test(newPassword)"
                      [class.text-gray-500]="!/[A-Z]/.test(newPassword)">
                  {{ /[A-Z]/.test(newPassword) ? 'check_circle' : 'radio_button_unchecked' }}
                </span>
                Une lettre majuscule
              </li>
              <li class="flex items-center gap-2">
                <span class="material-symbols-outlined text-[14px]"
                      [class.text-green-500]="/[0-9]/.test(newPassword)"
                      [class.text-gray-500]="!/[0-9]/.test(newPassword)">
                  {{ /[0-9]/.test(newPassword) ? 'check_circle' : 'radio_button_unchecked' }}
                </span>
                Un chiffre
              </li>
              <li class="flex items-center gap-2">
                <span class="material-symbols-outlined text-[14px]"
                      [class.text-green-500]="/[^a-zA-Z0-9]/.test(newPassword)"
                      [class.text-gray-500]="!/[^a-zA-Z0-9]/.test(newPassword)">
                  {{ /[^a-zA-Z0-9]/.test(newPassword) ? 'check_circle' : 'radio_button_unchecked' }}
                </span>
                Un caractère spécial
              </li>
            </ul>
          </div>
          
          <div>
            <button 
              class="w-full inline-flex items-center justify-center whitespace-nowrap rounded-lg bg-primary px-5 py-3 text-base font-bold text-background-dark transition-transform duration-200 hover:scale-[1.02] active:scale-[0.98] focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-surface-dark disabled:opacity-50 disabled:cursor-not-allowed" 
              type="submit"
              [disabled]="isSubmitting">
              <span *ngIf="!isSubmitting">Réinitialiser le mot de passe</span>
              <span *ngIf="isSubmitting" class="flex items-center gap-2">
                <span class="h-4 w-4 animate-spin rounded-full border-2 border-background-dark border-t-transparent"></span>
                Mise à jour...
              </span>
            </button>
          </div>
        </form>
        
        <div class="text-center mt-6">
          <a class="text-sm text-gray-400 hover:text-primary transition" routerLink="/login">
            <span class="material-symbols-outlined text-[16px] align-middle">arrow_back</span>
            Retour à la connexion
          </a>
        </div>
      </div>
    </div>
  </main>
  <app-footer></app-footer>
</div>
