<div class="group flex flex-col gap-3" [ngClass]="{'min-w-[200px] md:min-w-[240px] snap-start': variant === 'compact'}">
  <!-- Product Image Container -->
  <div class="relative aspect-[2/3] w-full overflow-hidden rounded-lg bg-surface-highlight border border-[#2E2419] shadow-lg">
    <!-- Badge: Discount, New, or Best-seller -->
    <div *ngIf="product.discountPercent" class="absolute right-2 top-2 z-10 rounded bg-red-600 px-2 py-1 text-xs font-bold text-white">
      -{{product.discountPercent}}%
    </div>
    <div *ngIf="product.badge && !product.discountPercent" class="absolute left-2 top-2 z-10 rounded px-2 py-1 text-[10px] font-bold uppercase tracking-wider"
         [ngClass]="product.badge === 'NOUVEAU' ? 'bg-white text-black' : 'bg-white text-black'">
      {{product.badge}}
    </div>

    <!-- Product Image -->
    <a [routerLink]="['/book', product.id]" class="block h-full w-full">
      <div class="h-full w-full bg-cover bg-center transition duration-500 group-hover:scale-105" 
           [style.background-image]="'url(' + product.imageUrl + ')'">
      </div>
    </a>

    <!-- Action Buttons (Favorite & Quick View) -->
    <div class="absolute top-2 right-2 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20"
         [ngClass]="{'!opacity-100': product.isFavorite}">
      <button (click)="toggleFavorite()" 
              class="rounded-full bg-black/60 p-2 text-white hover:bg-primary hover:text-background-dark transition backdrop-blur-sm shadow-md"
              [ngClass]="{'bg-primary text-background-dark': product.isFavorite}"
              title="Ajouter aux favoris">
        <span class="material-symbols-outlined text-[18px]">{{product.isFavorite ? 'favorite' : 'favorite'}}</span>
      </button>
      <button *ngIf="showQuickView" 
              (click)="quickView()"
              class="rounded-full bg-black/60 p-2 text-white hover:bg-primary hover:text-background-dark transition backdrop-blur-sm shadow-md"
              title="AperÃ§u rapide">
        <span class="material-symbols-outlined text-[18px]">visibility</span>
      </button>
    </div>

    <!-- Add to Cart Button (appears on hover) -->
    <div *ngIf="showAddToCart" 
         class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/90 via-black/60 to-transparent translate-y-full group-hover:translate-y-0 transition-transform duration-300">
      <button (click)="addToCart()"
              class="w-full rounded bg-primary py-2 text-sm font-bold text-background-dark hover:bg-white transition shadow-[0_0_15px_-3px_rgba(255,159,28,0.5)]">
        Ajouter au panier
      </button>
    </div>
  </div>

  <!-- Product Details -->
  <div class="flex flex-col gap-1">
    <!-- Category and Rating -->
    <div class="flex items-center justify-between">
      <span class="text-[10px] font-bold uppercase tracking-wider text-primary">{{product.category}}</span>
      <div class="flex text-primary">
        <span *ngFor="let star of getStarArray()" 
              class="material-symbols-outlined text-[14px]"
              [ngClass]="getStarClass(star)">
          {{getStarIcon(star)}}
        </span>
      </div>
    </div>

    <!-- Title -->
    <a [routerLink]="['/book', product.id]">
      <h3 class="line-clamp-1 text-base font-bold text-white group-hover:text-primary transition">
        {{product.title}}
      </h3>
    </a>

    <!-- Author (if provided) -->
    <p *ngIf="product.author" class="text-sm text-gray-400">{{product.author}}</p>

    <!-- Price and Format -->
    <div class="flex items-center gap-2 mt-1">
      <!-- Current Price -->
      <span class="text-lg font-bold" 
        [ngClass]="product.discountPercent ? 'text-primary' : 'text-white'">
        {{product.price.toFixed(2)}} {{currency}}
      </span>
      
      <!-- Original Price (if discounted) -->
      <span *ngIf="product.originalPrice" class="text-xs text-gray-500 line-through">
        {{product.originalPrice.toFixed(2)}} {{currency}}
      </span>

      <!-- Format Badge -->
      <span *ngIf="product.format" class="text-xs bg-surface-highlight border border-[#2E2419] px-1.5 py-0.5 rounded text-gray-400">
        {{product.format}}
      </span>
    </div>
  </div>
</div>
